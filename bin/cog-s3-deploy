#!/bin/bash

set -e

if [ -e Cogfile ]; then
    source ./Cogfile
fi

ARG_DIR=${DOCUMENT_ROOT:-./}
 
 while true ; do
     case "$1" in
         -d|--dir)
               case "$2" in
                 "") ARG_DIR='./' ; shift 2 ;;
                 *) ARG_DIR=$2 ; shift 2 ;;
               esac ;;
         --) shift ; break ;;
         "") break ;;
     esac
 done

obj=$(basename "$PWD")
branch=$(git symbolic-ref --short -q HEAD)
aws s3 cp $ARG_DIR s3://happycog-static/$obj/$branch --recursive --acl=public-read
