#!/bin/bash

# Yarn global adds the cog binary to your $PATH through a bunch of 
# symlinks. `readlink -f` isn't available on Mac, so this uses 
# Python to grab the fully resolved path of `cog` and then two
# `dirname`s to back out to the true installed repo directory.
COG_DIRECTORY=$(dirname $(dirname $(python -c "import os; print(os.path.realpath('${BASH_SOURCE[0]}'))")))
export COG_DIRECTORY;


# Include all scripts inside the tools folder
for file in $COG_DIRECTORY/tools/*; do
  source $file
done


# cog requires an argument. If there is no argument, cog will call cog-help
CMD=${1:-help}; shift

# Check if /bin exist in current directory and automaticlly include the .env file
if [ -d "$PWD/bin" ]; then
  if [ -f "$PWD/bin/cog-$CMD" ]; then
    ( set -a; source .env 2> /dev/null; "$PWD/bin/cog-$CMD" "${@}")
  else
    ( set -a; source .env 2> /dev/null; "$COG_DIRECTORY/bin/cog-$CMD" "${@}" )
  fi
else
    ( set -a; source .env 2> /dev/null; "$COG_DIRECTORY/bin/cog-$CMD" "${@}" )
fi