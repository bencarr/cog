#!/bin/bash
CMD=${1:-help}

# Yarn global adds the cog binary to your $PATH through a bunch of 
# symlinks. `readlink -f` isn't available on Mac, so this uses 
# Python to grab the fully resolved path of `cog` and then two
# `dirname`s to back out to the true installed repo directory.
DIR=$(dirname $(dirname $(python -c "import os; print(os.path.realpath('${BASH_SOURCE[0]}'))")))

# Include all scripts inside the tools folder
for file in $DIR/tools/*; do
  source $file
done

# Drop next argument
shift

# Check if /bin exist in current directory and automaticlly include the .env file
if [ -f "./bin/cog-$CMD" ]; then
    # Overwrite script exist. Run this
    ( set -a; source .env 2> /dev/null; "./bin/cog-$CMD" "${@}")
  else
    # Execute default scripts
    ( set -a; source .env 2> /dev/null; "$DIR/bin/cog-$CMD" "${@}" )
fi
